var Q=Object.defineProperty,G=Object.defineProperties;var $=Object.getOwnPropertyDescriptors;var z=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var N=(t,e,u)=>e in t?Q(t,e,{enumerable:!0,configurable:!0,writable:!0,value:u}):t[e]=u,b=(t,e)=>{for(var u in e||(e={}))K.call(e,u)&&N(t,u,e[u]);if(z)for(var u of z(e))Y.call(e,u)&&N(t,u,e[u]);return t},I=(t,e)=>G(t,$(e));import{r as v,a as B}from"./index.82c951e8.js";import{f as H}from"./fdb2e11a.js";import{u as J,C as L,a as W,b as X,c as Z,d as tt,e as rt,f as at,g as et,h as it}from"./6814dda7.js";import{C as ct}from"./a0a18359.js";import{b as st}from"./bc08dc6e.js";import"./62f37cd1.js";import{C as y}from"./0c9bea84.js";import"./92966185.js";import"./079e9649.js";import"./68abae6d.js";import"./7e2b3593.js";import"./acc1a395.js";import"./c522ed9a.js";const x="shopifyCartId";function dt(t,e){switch(e.type){case"cartFetch":{if(t.status==="uninitialized")return{status:"fetching"};break}case"cartCreate":{if(t.status==="uninitialized")return{status:"creating"};break}case"resolve":{if(["updating","fetching","creating"].includes(t.status))return{status:"idle",cart:e.cart};break}case"reject":{if(t.status==="fetching"||t.status==="creating")return{status:"uninitialized",error:e.error};if(t.status==="updating")return{status:"idle",cart:t.lastValidCart,error:e.error};break}case"resetCart":{if(t.status==="fetching")return{status:"uninitialized"};break}case"addLineItem":{if(t.status==="idle")return{status:"updating",cart:t.cart,lastValidCart:t.cart};break}case"removeLineItem":{if(t.status==="idle")return{status:"updating",cart:I(b({},t.cart),{lines:t.cart.lines.filter(({id:u})=>!e.lines.includes(u))}),lastValidCart:t.cart};break}case"updateLineItem":{if(t.status==="idle")return{status:"updating",cart:I(b({},t.cart),{lines:t.cart.lines.map(u=>{const f=e.lines.find(({id:C})=>C===u.id);return f&&f.quantity?I(b({},u),{quantity:f.quantity}):u})}),lastValidCart:t.cart};break}case"noteUpdate":{if(t.status==="idle")return{status:"updating",cart:t.cart,lastValidCart:t.cart};break}case"buyerIdentityUpdate":{if(t.status==="idle")return{status:"updating",cart:t.cart,lastValidCart:t.cart};break}case"cartAttributesUpdate":{if(t.status==="idle")return{status:"updating",cart:t.cart,lastValidCart:t.cart};break}case"discountCodesUpdate":{if(t.status==="idle")return{status:"updating",cart:t.cart,lastValidCart:t.cart};break}}throw new Error(`Cannot dispatch event (${e.type}) for current cart state (${t.status})`)}function _t({children:t,numCartLines:e,onCreate:u,onLineAdd:f,onLineRemove:C,onLineUpdate:g,onNoteUpdate:h,onBuyerIdentityUpdate:_,onAttributesUpdate:k,onDiscountCodesUpdate:U,data:m}){var A;const{serverProps:w}=st(),o=(A=w==null?void 0:w.country)===null||A===void 0?void 0:A.isoCode,P=m?{status:"idle",cart:p(m)}:{status:"uninitialized"},[l,s]=v.exports.useReducer((r,i)=>dt(r,i),P),n=J(),D=v.exports.useCallback(async r=>{s({type:"cartFetch"});const{data:i}=await n({query:L,variables:{id:r,numCartLines:e,country:o}});if(!(i!=null&&i.cart)){window.localStorage.removeItem(x),s({type:"resetCart"});return}s({type:"resolve",cart:p(i.cart)})},[n,e,o]),q=v.exports.useCallback(async r=>{var i,c;s({type:"cartCreate"}),u==null||u(),o&&!(!((i=r.buyerIdentity)===null||i===void 0)&&i.countryCode)&&(r.buyerIdentity==null&&(r.buyerIdentity={}),r.buyerIdentity.countryCode=o);const{data:a,error:d}=await n({query:W,variables:{input:r,numCartLines:e,country:o}});d&&s({type:"reject",error:d}),!((c=a==null?void 0:a.cartCreate)===null||c===void 0)&&c.cart&&(r.lines&&y.publish(y.eventNames.ADD_TO_CART,!0,{addedCartLines:r.lines,cart:a.cartCreate.cart}),s({type:"resolve",cart:p(a.cartCreate.cart)}),window.localStorage.setItem(x,a.cartCreate.cart.id))},[u,n,e,o]),T=v.exports.useCallback(async(r,i)=>{var c;if(i.status==="idle"){s({type:"addLineItem"}),f==null||f();const{data:a,error:d}=await n({query:X,variables:{cartId:i.cart.id,lines:r,numCartLines:e,country:o}});d&&s({type:"reject",error:d}),!((c=a==null?void 0:a.cartLinesAdd)===null||c===void 0)&&c.cart&&(y.publish(y.eventNames.ADD_TO_CART,!0,{addedCartLines:r,cart:a.cartLinesAdd.cart}),s({type:"resolve",cart:p(a.cartLinesAdd.cart)}))}},[n,e,f,o]),j=v.exports.useCallback(async(r,i)=>{var c;if(i.status==="idle"){s({type:"removeLineItem",lines:r}),C==null||C();const{data:a,error:d}=await n({query:Z,variables:{cartId:i.cart.id,lines:r,numCartLines:e,country:o}});d&&s({type:"reject",error:d}),!((c=a==null?void 0:a.cartLinesRemove)===null||c===void 0)&&c.cart&&(y.publish(y.eventNames.REMOVE_FROM_CART,!0,{removedCartLines:r,cart:a.cartLinesRemove.cart}),s({type:"resolve",cart:p(a.cartLinesRemove.cart)}))}},[n,C,e,o]),E=v.exports.useCallback(async(r,i)=>{var c;if(i.status==="idle"){s({type:"updateLineItem",lines:r}),g==null||g();const{data:a,error:d}=await n({query:tt,variables:{cartId:i.cart.id,lines:r,numCartLines:e,country:o}});d&&s({type:"reject",error:d}),!((c=a==null?void 0:a.cartLinesUpdate)===null||c===void 0)&&c.cart&&(y.publish(y.eventNames.UPDATE_CART,!0,{updatedCartLines:r,oldCart:i.cart}),s({type:"resolve",cart:p(a.cartLinesUpdate.cart)}))}},[n,g,e,o]),S=v.exports.useCallback(async(r,i)=>{var c;if(i.status==="idle"){s({type:"noteUpdate"}),h==null||h();const{data:a,error:d}=await n({query:rt,variables:{cartId:i.cart.id,note:r,numCartLines:e,country:o}});d&&s({type:"reject",error:d}),!((c=a==null?void 0:a.cartNoteUpdate)===null||c===void 0)&&c.cart&&s({type:"resolve",cart:p(a.cartNoteUpdate.cart)})}},[n,h,e,o]),R=v.exports.useCallback(async(r,i)=>{var c;if(i.status==="idle"){s({type:"buyerIdentityUpdate"}),_==null||_();const{data:a,error:d}=await n({query:at,variables:{cartId:i.cart.id,buyerIdentity:r,numCartLines:e,country:o}});d&&s({type:"reject",error:d}),!((c=a==null?void 0:a.cartBuyerIdentityUpdate)===null||c===void 0)&&c.cart&&s({type:"resolve",cart:p(a.cartBuyerIdentityUpdate.cart)})}},[n,_,e,o]),V=v.exports.useCallback(async(r,i)=>{var c;if(i.status==="idle"){s({type:"cartAttributesUpdate"}),k==null||k();const{data:a,error:d}=await n({query:et,variables:{cartId:i.cart.id,attributes:r,numCartLines:e,country:o}});d&&s({type:"reject",error:d}),!((c=a==null?void 0:a.cartAttributesUpdate)===null||c===void 0)&&c.cart&&s({type:"resolve",cart:p(a.cartAttributesUpdate.cart)})}},[n,k,e,o]),F=v.exports.useCallback(async(r,i)=>{var c;if(i.status==="idle"){s({type:"discountCodesUpdate"}),U==null||U();const{data:a,error:d}=await n({query:it,variables:{cartId:i.cart.id,discountCodes:r,numCartLines:e,country:o}});d&&s({type:"reject",error:d}),!((c=a==null?void 0:a.cartDiscountCodesUpdate)===null||c===void 0)&&c.cart&&(y.publish(y.eventNames.DISCOUNT_CODE_UPDATED,!0,{updatedDiscountCodes:r,cart:a.cartDiscountCodesUpdate.cart}),s({type:"resolve",cart:p(a.cartDiscountCodesUpdate.cart)}))}},[n,U,e,o]),O=v.exports.useRef(!1);v.exports.useEffect(()=>{localStorage.getItem(x)&&l.status==="uninitialized"&&!O.current&&(O.current=!0,D(localStorage.getItem(x)))},[D,l]),v.exports.useEffect(()=>{l.status==="idle"&&R({countryCode:o},l)},[o]);const M=v.exports.useMemo(()=>I(b({},"cart"in l?l.cart:b({lines:[],attributes:[]},m?p(m):{})),{status:l.status,error:"error"in l?l.error:void 0,totalQuantity:"cart"in l?l.cart.lines.reduce((r,i)=>r+i.quantity,0):0,cartCreate:q,linesAdd(r){"cart"in l&&l.cart.id?T(r,l):q({lines:r})},linesRemove(r){j(r,l)},linesUpdate(r){E(r,l)},noteUpdate(r){S(r,l)},buyerIdentityUpdate(r){R(r,l)},cartAttributesUpdate(r){V(r,l)},discountCodesUpdate(r){F(r,l)}}),[l,m,q,T,j,E,S,R,V,F]);return B(ct.Provider,{value:M,children:t})}function p(t){var e;return I(b({},t),{lines:H(t.lines),note:(e=t.note)!==null&&e!==void 0?e:void 0})}export{_t as CartProvider};
//# sourceMappingURL=e4fc8cc3.js.map
